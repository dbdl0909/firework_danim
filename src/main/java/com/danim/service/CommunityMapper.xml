<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="com.danim.service">
	<update id="modifyCommunityItem"
			parameterType="com.danim.service.community.CommunityDto">
		UPDATE
			community
		SET
			community_subject = #{communitySubject},
			<if test="communityNotice == null">
				community_notice = 'F',
			</if>
			<if test="communityNotice != null">
				community_notice = #{communityNotice},
			</if>
			community_content = #{communityContent}
		WHERE
			community_no = #{communityNo};	
	</update>
	<!-- 공지사항 출력리스트  -->
	<select id="selectCommunityNoticeList"
		parameterType="String"
		resultType="com.danim.service.community.CommunityDto">
		SELECT 
			community_no as communityNo,
			member_id as memberId,
			community_category_no as communityCategoryNo,
			community_subject as communitySubject,
			community_readcount as communityReadcount,
			community_notice as communityNotice,
			community_date as communityDate			
		FROM
			community
		WHERE
			community_category_no = #{communityCategoryNo}
		AND
			community_notice = 'T'	
		ORDER BY communityNo DESC	
	</select>
	<!-- 해당 카테고리 내의 총 게시글 -->
	<select id="countCommunityList" 
		parameterType="String"
		resultType="Integer" >
	SELECT 
		COUNT(*) 
	FROM 
		community
	WHERE 
		community_category_no = #{communityCategoryNo};
	</select>	
	<!-- 해당 게시글 detail -->
	<select id="selectDetailViewByCommunityNo"
			parameterType="int"
			resultType="com.danim.service.community.CommunityDto">
		SELECT
			community_no as communityNo,
			community_category_no as communityCategoryNo,
			community_notice as communityNotice,
			member_id as memberId,
			community_subject as communitySubject,
			community_content as communityContent,
			community_readcount as communityReadcount,
			community_rating as communityRating,
			community_date as communityDate
		FROM
			community
		WHERE
			community_no = #{communityNo};
	
	</select> 
	<!-- 해당 카테고리 리스트 -->
	<select id="selectCommunityList"
			parameterType="java.util.Map"
			resultType="com.danim.service.community.CommunityDto">
		SELECT 
			community_no as communityNo,
			member_id as memberId,
			community_category_no as communityCategoryNo,
			community_subject as communitySubject,
			community_readcount as communityReadcount,
			community_notice as communityNotice,
			community_date as communityDate			
		FROM
			community
		WHERE
			community_category_no = #{communityCategoryNo}
		ORDER BY communityNo DESC	
		LIMIT #{pageNation.startRow} , #{pageNation.linePerPage};	
	</select>
	<!-- 게시글 입력 -->	
	<insert 
		id="insertCommunityItem" 
		parameterType="com.danim.service.community.CommunityDto">
		INSERT INTO
		community(
			community_no,
			community_category_no,
			member_id,
			community_subject,
			<if test="communityNotice != null">
				community_notice,
			</if>
			community_content,
			community_date,
			community_update	
		)VALUES(
			#{communityNo},
			#{communityCategoryNo},
			#{memberId},
			#{communitySubject},
			<if test="communityNotice != null">
				#{communityNotice},
			</if>
			#{communityContent},
			SYSDATE(),
			SYSDATE()
		);
	</insert>	
</mapper>	
